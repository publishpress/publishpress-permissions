jQuery(document).ready(function($){var $tabsWrapper=$('#publishpress-permissions-teaser-tabs');$tabsWrapper.find('li').click(function(e){e.preventDefault();$tabsWrapper.children('li').filter('.nav-tab-active').removeClass('nav-tab-active');$(this).addClass('nav-tab-active');var panel=$(this).find('a').first().attr('href');$('section[id^="ppp-"]').hide();$(panel).show();var current_tab=$(this).find('a').attr('href').replace('#','');$('#current_tab').val(current_tab)});$('.ppp-expand-code').bind('click',function(e){e.preventDefault();var codeArea=$(this).closest('.ppp-code-sample').find('textarea');if($(this).attr('data-expand')==='closed'){codeArea.css('height',codeArea[0].scrollHeight);$(this).attr('data-expand','opened');$(this).find('.ppp-expand-msg').hide();$(this).find('.ppp-collapse-msg').show()}else{codeArea.css('height',200);$(this).attr('data-expand','closed');$(this).find('.ppp-collapse-msg').hide();$(this).find('.ppp-expand-msg').show()}});$('.ppp-copy-code').bind('click',function(e){e.preventDefault();var codeArea=$(this).closest('.ppp-code-sample').find('textarea');codeArea.select();document.execCommand('copy');if($(this).attr('data-copy')==='uncopied'){$(this).find('.ppp-uncopied-msg').hide();$(this).find('.ppp-copied-msg').show()}else{$(this).attr('data-expand','closed');$(this).find('.ppp-copied-msg').hide();$(this).find('.ppp-uncopied-msg').show()}});$('.permissions_select_posts').select2({placeholder:presspermitTeaser.strings.select_a_page,allowClear:true,ajax:{url:presspermitTeaser.url,dataType:'json',method:'get',delay:250,data:function(params){return{search:params.term,action:'pp_search_posts',nonce:presspermitTeaser.nonce}},processResults:function(data){var options=[];if(data){$.each(data,function(index,item){options.push({id:item.ID,text:item.post_title})});return{results:options}}}}});$('.permissions_select_terms').select2({placeholder:presspermitTeaser.strings.select_terms,ajax:{url:presspermitTeaser.url,dataType:'json',method:'get',delay:250,data:function(params){return{search:params.term,action:'pp_search_terms',taxonomy:$('#teaser_hide_links_taxonomy').val(),nonce:presspermitTeaser.nonce}},processResults:function(data){var options=[];if(data){$.each(data,function(index,item){options.push({id:item.term_id,text:item.name})});return{results:options}}}}});$('div.teaser-coverage-post select').on('change',function(){$(this).siblings('span.teaser-num-chars').toggle($(this).val()=='x_chars')});$('#ppp-tab-redirect select.teaser-redirect-mode').on('change',function(){$(this).parent('td').siblings('td').find('div.pp-select-dynamic-wrapper').toggle($(this).val()=='(select)')});$(document).on('click','.pp-expand-icon',function(e){e.preventDefault();e.stopPropagation();var $icon=$(this);var $mainRow=$icon.closest('tr.pp-main-row');var postType=$mainRow.data('post-type');var $detailRow=$('.pp-detail-'+postType);if($detailRow.is(':visible')){$icon.removeClass('pp-expanded');$mainRow.removeClass('pp-expanded');setTimeout(function(){$detailRow.toggle();$detailRow.removeClass("expanded")},150)}else{$icon.addClass('pp-expanded');$mainRow.addClass('pp-expanded');setTimeout(function(){$detailRow.toggle();$detailRow.addClass("expanded")},150)}});$(document).on('change','select.teaser-type-select',function(){var $select=$(this);var $mainRow=$select.closest('tr.pp-main-row');var postType=$mainRow.data('post-type');var $expandIcon=$mainRow.find('.pp-expand-icon');var $detailRow=$('.pp-detail-'+postType);var $userApplicationDiv=$mainRow.find('div.teaser_vspace');var $numCharsSpan=$select.siblings('span.teaser-num-chars');var isEnabled=$select.val()!='0';$expandIcon.toggle(isEnabled);$userApplicationDiv.toggle(isEnabled);$numCharsSpan.toggle($select.val()=='x_chars');$mainRow.attr('data-row-active',isEnabled?'1':'0');if(!isEnabled){$expandIcon.removeClass('pp-expanded');$mainRow.removeClass('pp-expanded');$detailRow.slideUp(200)}var ppAnyTeaserTypesEnabled=$('select.teaser-type-select option:selected[value!="0"]').length;$('th.pp-teaser-user-application span').toggle(ppAnyTeaserTypesEnabled>0)});$('.teaser-redirect-section select.teaser-redirect-mode').on('change',function(){$(this).parent('td').siblings('td').find('div.pp-select-dynamic-wrapper').toggle($(this).val()=='(select)')});$('#pp_current_post_type').on('change',function(){var selectedType=$(this).val();$('#selected_post_type').val(selectedType);$('.pp-teaser-settings-container').removeClass('active').hide();var $selectedContainer=$('.pp-teaser-settings-container[data-post-type="'+selectedType+'"]');$selectedContainer.addClass('active pp-fade-in').show();var teaserType=$selectedContainer.find('.pp-teaser-type-select').val();if(teaserType=='0'){$selectedContainer.find('.pp-teaser-redirect-settings').slideUp(300);$selectedContainer.find('.pp-teaser-application-fields').slideUp(300);$selectedContainer.find('.pp-teaser-text-card').slideUp(300)}else if(teaserType=='redirect'){$selectedContainer.find('.pp-teaser-redirect-settings').slideDown(300);$selectedContainer.find('.pp-teaser-application-fields').slideDown(300);$selectedContainer.find('.pp-teaser-text-card').slideUp(300)}else if(teaserType=='1'){$selectedContainer.find('.pp-teaser-text-card').slideDown(300);$selectedContainer.find('.pp-teaser-application-fields').slideDown(300);$selectedContainer.find('.pp-teaser-redirect-settings').slideUp(300)}else{$selectedContainer.find('.pp-teaser-application-fields').slideDown(300);$selectedContainer.find('.pp-teaser-text-card').slideUp(300);$selectedContainer.find('.pp-teaser-redirect-settings').slideUp(300)}});$(document).on('change','.pp-teaser-type-select',function(){var $container=$(this).closest('.pp-teaser-settings-container');var selectedType=$(this).val();var postType=$container.data('post-type');if(selectedType=='x_chars'){$container.find('.pp-num-chars-setting').fadeIn(300);$container.find('.pp-excerpt-chars-setting').fadeOut(300)}else if(selectedType=='excerpt'){$container.find('.pp-excerpt-chars-setting').fadeIn(300);$container.find('.pp-num-chars-setting').fadeOut(300)}else{$container.find('.pp-num-chars-setting').fadeOut(300);$container.find('.pp-excerpt-chars-setting').fadeOut(300)}if(selectedType=='0'){$container.find('.pp-teaser-redirect-settings').slideUp(300);$container.find('.pp-teaser-text-card').slideUp(300);$container.find('.pp-read-more-notice-card').slideUp(300);$container.find('.pp-excerpt-notice-card').slideUp(300);$container.find('.pp-x-chars-notice-card').slideUp(300);$container.find('.pp-teaser-application-fields').slideUp(300)}else if(selectedType=='redirect'){$container.find('.pp-teaser-redirect-settings').slideDown(300);$container.find('.pp-teaser-application-fields').slideDown(300);$container.find('.pp-teaser-text-card').slideUp(300);$container.find('.pp-read-more-notice-card').slideUp(300);$container.find('.pp-excerpt-notice-card').slideUp(300);$container.find('.pp-x-chars-notice-card').slideUp(300)}else if(selectedType=='1'){$container.find('.pp-teaser-text-card').slideDown(300);$container.find('.pp-teaser-application-fields').slideDown(300);$container.find('.pp-teaser-redirect-settings').slideUp(300);$container.find('.pp-read-more-notice-card').slideUp(300);$container.find('.pp-excerpt-notice-card').slideUp(300);$container.find('.pp-x-chars-notice-card').slideUp(300)}else if(selectedType=='read_more'){$container.find('.pp-read-more-notice-card').slideDown(300);$container.find('.pp-teaser-application-fields').slideDown(300);$container.find('.pp-teaser-text-card').slideUp(300);$container.find('.pp-teaser-redirect-settings').slideUp(300);$container.find('.pp-excerpt-notice-card').slideUp(300);$container.find('.pp-x-chars-notice-card').slideUp(300)}else if(selectedType=='excerpt'){$container.find('.pp-excerpt-notice-card').slideDown(300);$container.find('.pp-teaser-application-fields').slideDown(300);$container.find('.pp-teaser-text-card').slideUp(300);$container.find('.pp-teaser-redirect-settings').slideUp(300);$container.find('.pp-read-more-notice-card').slideUp(300);$container.find('.pp-x-chars-notice-card').slideUp(300)}else if(selectedType=='x_chars'||selectedType=='more'){$container.find('.pp-x-chars-notice-card').slideDown(300);$container.find('.pp-teaser-application-fields').slideDown(300);$container.find('.pp-teaser-text-card').slideUp(300);$container.find('.pp-teaser-redirect-settings').slideUp(300);$container.find('.pp-read-more-notice-card').slideUp(300);$container.find('.pp-excerpt-notice-card').slideUp(300)}else{$container.find('.pp-teaser-application-fields').slideDown(300);$container.find('.pp-teaser-text-card').slideUp(300);$container.find('.pp-read-more-notice-card').slideUp(300);$container.find('.pp-excerpt-notice-card').slideUp(300);$container.find('.pp-x-chars-notice-card').slideUp(300);$container.find('.pp-teaser-redirect-settings').slideUp(300)}});$(document).on('click','.pp-teaser-text-tab',function(){var tab=$(this).data('tab');var $card=$(this).closest('.pp-teaser-card');$card.find('.pp-teaser-text-tab').removeClass('active');$(this).addClass('active');$card.find('.pp-teaser-text-content').removeClass('active').hide();$card.find('.pp-teaser-text-content[data-tab-content="'+tab+'"]').addClass('active').fadeIn(200)});function initializeProgressiveUIVisibility(){var savedPostType=$('#selected_post_type').val();var $targetContainer;if(savedPostType&&$('.pp-teaser-settings-container[data-post-type="'+savedPostType+'"]').length){$targetContainer=$('.pp-teaser-settings-container[data-post-type="'+savedPostType+'"]');$('#pp_current_post_type').val(savedPostType)}else{$targetContainer=$('.pp-teaser-settings-container').first();if($targetContainer.length){var $firstEnabledOption=$('#pp_current_post_type option:not(:disabled)').first();var firstPostType=$firstEnabledOption.length?$firstEnabledOption.val():$targetContainer.data('post-type');$('#pp_current_post_type').val(firstPostType);$('#selected_post_type').val(firstPostType)}}if($targetContainer&&$targetContainer.length){$targetContainer.addClass('active').show();var teaserType=$targetContainer.find('.pp-teaser-type-select').val();if(teaserType=='0'){$targetContainer.find('.pp-teaser-redirect-settings').hide();$targetContainer.find('.pp-teaser-text-card').hide();$targetContainer.find('.pp-read-more-notice-card').hide();$targetContainer.find('.pp-excerpt-notice-card').hide();$targetContainer.find('.pp-x-chars-notice-card').hide();$targetContainer.find('.pp-teaser-application-fields').hide()}else if(teaserType=='redirect'){$targetContainer.find('.pp-teaser-redirect-settings').show();$targetContainer.find('.pp-teaser-application-fields').show();$targetContainer.find('.pp-teaser-text-card').hide();$targetContainer.find('.pp-read-more-notice-card').hide();$targetContainer.find('.pp-excerpt-notice-card').hide();$targetContainer.find('.pp-x-chars-notice-card').hide()}else if(teaserType=='1'){$targetContainer.find('.pp-teaser-text-card').show();$targetContainer.find('.pp-teaser-application-fields').show();$targetContainer.find('.pp-teaser-redirect-settings').hide();$targetContainer.find('.pp-read-more-notice-card').hide();$targetContainer.find('.pp-excerpt-notice-card').hide();$targetContainer.find('.pp-x-chars-notice-card').hide()}else if(teaserType=='read_more'){$targetContainer.find('.pp-read-more-notice-card').show();$targetContainer.find('.pp-teaser-application-fields').show();$targetContainer.find('.pp-teaser-text-card').hide();$targetContainer.find('.pp-teaser-redirect-settings').hide();$targetContainer.find('.pp-excerpt-notice-card').hide();$targetContainer.find('.pp-x-chars-notice-card').hide()}else if(teaserType=='excerpt'){$targetContainer.find('.pp-excerpt-notice-card').show();$targetContainer.find('.pp-teaser-application-fields').show();$targetContainer.find('.pp-teaser-text-card').hide();$targetContainer.find('.pp-teaser-redirect-settings').hide();$targetContainer.find('.pp-read-more-notice-card').hide();$targetContainer.find('.pp-x-chars-notice-card').hide()}else if(teaserType=='x_chars'||teaserType=='more'){$targetContainer.find('.pp-x-chars-notice-card').show();$targetContainer.find('.pp-teaser-application-fields').show();$targetContainer.find('.pp-teaser-text-card').hide();$targetContainer.find('.pp-teaser-redirect-settings').hide();$targetContainer.find('.pp-read-more-notice-card').hide();$targetContainer.find('.pp-excerpt-notice-card').hide()}else{$targetContainer.find('.pp-teaser-application-fields').show();$targetContainer.find('.pp-teaser-text-card').hide();$targetContainer.find('.pp-read-more-notice-card').hide();$targetContainer.find('.pp-excerpt-notice-card').hide();$targetContainer.find('.pp-x-chars-notice-card').hide();$targetContainer.find('.pp-teaser-redirect-settings').hide()}if(teaserType=='x_chars'){$targetContainer.find('.pp-num-chars-setting').show();$targetContainer.find('.pp-excerpt-chars-setting').hide()}else if(teaserType=='excerpt'){$targetContainer.find('.pp-excerpt-chars-setting').show();$targetContainer.find('.pp-num-chars-setting').hide()}}}initializeProgressiveUIVisibility();$('#teaser_redirect_anon').on('change',function(){var $pageSelect=$('#teaser_redirect_anon_page').closest('.pp-select-dynamic-wrapper');if($(this).val()=='(select)'){$pageSelect.show()}else{$pageSelect.hide();$('#teaser_redirect_anon_page').val('')}});$('#teaser_redirect').on('change',function(){var $pageSelect=$('#teaser_redirect_page').closest('.pp-select-dynamic-wrapper');if($(this).val()=='(select)'){$pageSelect.show()}else{$pageSelect.hide();$('#teaser_redirect_page').val('')}});$('.pp-add-login-form a').on('click',function(e){e.preventDefault();var $container=$(this).closest('td, div');var editorId=$container.find('.wp-editor-area').attr('id');if(editorId){if(typeof tinymce!=='undefined'&&tinymce.get(editorId)&&!tinymce.get(editorId).isHidden()){var editor=tinymce.get(editorId);var content=editor.getContent();if(content.indexOf('[login_form]')===-1){editor.setContent(content+'[login_form]')}}else{var $textarea=$('#'+editorId);if($textarea.length&&$textarea.val().indexOf('[login_form]')===-1){$textarea.val($textarea.val()+'[login_form]')}}}return false});$(document).on('change','select.pp-teaser-type-select',function(){var $select=$(this);var $selected=$select.find('option:selected');if($selected.is(':disabled')){var $firstEnabled=$select.find('option:not(:disabled)').first();$select.val($firstEnabled.val());alert('This feature is only available in PublishPress Permissions PRO.\n\nUpgrade now to unlock advanced teaser types including Read More links, excerpts, and redirects.')}});$(document).on('change','#pp_current_post_type',function(){var $select=$(this);var $selected=$select.find('option:selected');if($selected.is(':disabled')){var $firstEnabled=$select.find('option:not(:disabled)').first();$select.val($firstEnabled.val()).trigger('change');alert('This post type is only available in PublishPress Permissions PRO.\n\nUpgrade now to apply teasers to Pages, WooCommerce Products, and all custom post types.')}});$(document).on('click','input[type="radio"][name^="tease_logged_only"]:disabled',function(e){e.preventDefault();alert('User-specific targeting is only available in PublishPress Permissions PRO.\n\nUpgrade now to show different teaser messages to logged-in vs anonymous users.');return false});$(document).on('click','.pp-pro-badge',function(e){e.stopPropagation();var upgradeUrl='https://publishpress.com/links/permissions-banner';if(confirm('This feature is only available in PublishPress Permissions PRO.\n\nWould you like to learn more about upgrading?')){window.open(upgradeUrl,'_blank')}});$('select option:disabled').css({color:'#999','font-style':'italic'});$('input[type="radio"]:disabled').each(function(){$(this).closest('label').css({opacity:'0.5',cursor:'not-allowed'})})});